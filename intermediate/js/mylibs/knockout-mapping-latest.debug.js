(function(e){typeof require==="function"&&typeof exports==="object"&&typeof module==="object"?e(require("knockout"),exports):typeof define==="function"&&define.amd?define(["knockout","exports"],e):e(ko,ko.mapping={})})(function(e,f){function J(a,b){var c=f.getType,d,l={include:!0,ignore:!0,copy:!0},h,g,k=1,p=arguments.length;for(c(a)!=="object"&&(a={});k<p;k++)for(d in b=arguments[k],c(b)!=="object"&&(b={}),b){h=a[d];g=b[d];if(d!=="constructor"&&l[d]&&c(g)!=="array"){if(c(g)!=="string")throw Error("ko.mapping.defaultOptions()."+
d+" should be an array or string.");g=[g]}switch(c(g)){case "object":h=c(h)==="object"?h:{};a[d]=J(h,g);break;case "array":h=c(h)==="array"?h:[];a[d]=e.utils.arrayGetDistinctValues(e.utils.arrayPushAll(h,g));break;default:a[d]=g}}return a}function i(){var a=e.utils.arrayPushAll([{},q],arguments);return a=J.apply(this,a)}function O(a,b){var c=e.dependentObservable;e.dependentObservable=function(b,c,d){d=d||{};b&&typeof b=="object"&&(d=b);var f=d.deferEvaluation,p=!1,z=function(b){var c=w({read:function(){p||
(e.utils.arrayRemoveItem(a,b),p=!0);return b.apply(b,arguments)},write:function(a){return b(a)},deferEvaluation:!0});if(P)c._wrapper=!0;return c};d.deferEvaluation=!0;b=new w(b,c,d);f||(b=z(b),a.push(b));return b};e.dependentObservable.fn=w.fn;e.computed=e.dependentObservable;var d=b();e.dependentObservable=c;e.computed=e.dependentObservable;return d}function C(a,b,c,d,l,h){var g=e.utils.unwrapObservable(b)instanceof Array;d!==void 0&&f.isMapped(a)&&(c=e.utils.unwrapObservable(a)[r],h=d="");var d=
d||"",h=h||"",k=function(a){var b;if(d==="")b=c[a];else if(b=c[d])b=b[a];return b},p=function(){return k("create")instanceof Function},z=function(a){return O(D,function(){return k("create")({data:a||b,parent:l})})},o=function(){return k("update")instanceof Function},m=function(a,c){var d={data:c||b,parent:l,target:e.utils.unwrapObservable(a)};if(e.isWriteableObservable(a))d.observable=a;return k("update")(d)},u=v.get(b);if(u)return u;if(g){var g=[],j=(u=k("key")instanceof Function)?k("key"):function(a){return a};
if(!e.isObservable(a))a=e.observableArray([]),a.mappedRemove=function(b){var c=typeof b=="function"?b:function(a){return a===j(b)};return a.remove(function(a){return c(j(a))})},a.mappedRemoveAll=function(b){var c=A(b,j);return a.remove(function(a){return e.utils.arrayIndexOf(c,j(a))!=-1})},a.mappedDestroy=function(b){var c=typeof b=="function"?b:function(a){return a===j(b)};return a.destroy(function(a){return c(j(a))})},a.mappedDestroyAll=function(b){var c=A(b,j);return a.destroy(function(a){return e.utils.arrayIndexOf(c,
j(a))!=-1})},a.mappedIndexOf=function(b){var c=A(a(),j),b=j(b);return e.utils.arrayIndexOf(c,b)},a.mappedCreate=function(b){if(a.mappedIndexOf(b)!==-1)throw Error("There already is an object with the key that you specified.");var c=p()?z(b):b;o()&&(b=m(c,b),e.isWriteableObservable(c)?c(b):c=b);a.push(c);return c};var n=A(e.utils.unwrapObservable(a),j).sort(),i=A(b,j);u&&i.sort();for(var u=e.utils.compareArrays(n,i),n={},i=[],q=0,y=u.length;q<y;q++){var x=u[q],s,t=E(h,b,q);switch(x.status){case "added":var B=
F(e.utils.unwrapObservable(b),x.value,j);s=C(void 0,B,c,d,a,t);p()||(s=e.utils.unwrapObservable(s));t=K(e.utils.unwrapObservable(b),B,n);i[t]=s;n[t]=!0;break;case "retained":B=F(e.utils.unwrapObservable(b),x.value,j);s=F(a,x.value,j);C(s,B,c,d,a,t);t=K(e.utils.unwrapObservable(b),B,n);i[t]=s;n[t]=!0;break;case "deleted":s=F(a,x.value,j)}g.push({event:x.status,item:s})}a(i);var w=k("arrayChanged");w instanceof Function&&e.utils.arrayForEach(g,function(a){w(a.event,a.item)})}else if(G(b)){a=e.utils.unwrapObservable(a);
if(!a)if(p())return n=z(),o()&&(n=m(n)),n;else{if(o())return m(n);a={}}o()&&(a=m(a));v.save(b,a);L(b,function(d){var f=E(h,b,d);if(e.utils.arrayIndexOf(c.ignore,f)==-1)if(e.utils.arrayIndexOf(c.copy,f)!=-1)a[d]=b[d];else{var g=v.get(b[d])||C(a[d],b[d],c,d,a,f);if(e.isWriteableObservable(a[d]))a[d](e.utils.unwrapObservable(g));else a[d]=g;c.mappedProperties[f]=!0}})}else switch(f.getType(b)){case "function":o()?e.isWriteableObservable(b)?(b(m(b)),a=b):a=m(b):a=b;break;default:e.isWriteableObservable(a)?
o()?a(m(a)):a(e.utils.unwrapObservable(b)):(a=p()?z():e.observable(e.utils.unwrapObservable(b)),o()&&a(m(a)))}return a}function K(a,b,c){for(var d=0,e=a.length;d<e;d++)if(c[d]!==!0&&a[d]===b)return d;return null}function M(a,b){var c;b&&(c=b(a));f.getType(c)==="undefined"&&(c=a);return e.utils.unwrapObservable(c)}function F(a,b,c){a=e.utils.arrayFilter(e.utils.unwrapObservable(a),function(a){return M(a,c)===b});if(a.length==0)throw Error("When calling ko.update*, the key '"+b+"' was not found!");
if(a.length>1&&G(a[0]))throw Error("When calling ko.update*, the key '"+b+"' was not unique!");return a[0]}function A(a,b){return e.utils.arrayMap(e.utils.unwrapObservable(a),function(a){return b?M(a,b):a})}function L(a,b){if(a instanceof Array)for(var c=0;c<a.length;c++)b(c);else for(c in a)b(c)}function G(a){var b=f.getType(a);return(b==="object"||b==="array")&&a!==null&&b!=="undefined"}function E(a,b,c){var d=a||"";b instanceof Array?a&&(d+="["+c+"]"):(a&&(d+="."),d+=c);return d}function H(a,b,
c,d,l){d!==void 0&&f.isMapped(a)&&(c=i(e.utils.unwrapObservable(a)[r],c),d="");d===void 0&&(v=new N);var d=d||"",h,g=e.utils.unwrapObservable(a);if(G(g))b(a,l),h=g instanceof Array?[]:{};else return b(a,l);v.save(a,h);var k=l;L(g,function(a){if(!(c.ignore&&e.utils.arrayIndexOf(c.ignore,a)!=-1)){var i=g[a],o=E(d,g,a);if(!(e.utils.arrayIndexOf(c.copy,a)===-1&&e.utils.arrayIndexOf(c.include,a)===-1&&c.mappedProperties&&!c.mappedProperties[o]&&!(g instanceof Array)))switch(l=E(k,g,a),f.getType(e.utils.unwrapObservable(i))){case "object":case "array":case "undefined":var m=
v.get(i);h[a]=f.getType(m)!=="undefined"?m:H(i,b,c,o,l);break;default:h[a]=b(i,l)}}});return h}function N(){var a=[],b=[];this.save=function(c,d){var f=e.utils.arrayIndexOf(a,c);f>=0?b[f]=d:(a.push(c),b.push(d))};this.get=function(c){c=e.utils.arrayIndexOf(a,c);return c>=0?b[c]:void 0}}var P=!0,r="__ko_mapping__",w=e.dependentObservable,I=0,D,v,y={include:["_destroy"],ignore:[],copy:[]},q=y;f.isMapped=function(a){return(a=e.utils.unwrapObservable(a))&&a[r]};f.fromJS=function(a){if(arguments.length==
0)throw Error("When calling ko.fromJS, pass the object you want to convert.");window.setTimeout(function(){I=0},0);I++||(D=[],v=new N);var b,c;arguments.length==2&&(arguments[1][r]?c=arguments[1]:b=arguments[1]);arguments.length==3&&(b=arguments[1],c=arguments[2]);b=c?i(c[r],b):i(b);b.mappedProperties=b.mappedProperties||{};var d=C(c,a,b);c&&(d=c);--I||window.setTimeout(function(){for(;D.length;){var a=D.pop();a&&a()}},0);d[r]=i(d[r],b);return d};f.fromJSON=function(a){var b=e.utils.parseJson(a);
arguments[0]=b;return f.fromJS.apply(this,arguments)};f.updateFromJS=function(){throw Error("ko.mapping.updateFromJS, use ko.mapping.fromJS instead. Please note that the order of parameters is different!");};f.updateFromJSON=function(){throw Error("ko.mapping.updateFromJSON, use ko.mapping.fromJSON instead. Please note that the order of parameters is different!");};f.toJS=function(a,b){if(arguments.length==0)throw Error("When calling ko.mapping.toJS, pass the object you want to convert.");b=i(a[r],
b);return H(a,function(a){return e.utils.unwrapObservable(a)},b)};f.toJSON=function(a,b){var c=f.toJS(a,b);return e.utils.stringifyJson(c)};f.visitModel=function(a,b,c){if(arguments.length==0)throw Error("When calling ko.mapping.visitModel, pass the object you want to visit.");c=i(a[r],c);return H(a,b,c)};f.defaultOptions=function(){if(arguments.length>0)q=arguments[0];else return q};f.resetDefaultOptions=function(){q={include:y.include.slice(0),ignore:y.ignore.slice(0),copy:y.copy.slice(0)}};f.getType=
function(a){if(a&&typeof a==="object"){if(a.constructor==(new Date).constructor)return"date";if(a.constructor==[].constructor)return"array"}return typeof a}});
