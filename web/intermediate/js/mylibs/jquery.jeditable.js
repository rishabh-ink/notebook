(function(a){a.fn.editable=function(c,e){if("disable"==c)a(this).data("disabled.editable",!0);else if("enable"==c)a(this).data("disabled.editable",!1);else if("destroy"==c)a(this).unbind(a(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable");else{var b=a.extend({},a.fn.editable.defaults,{target:c},e),h=a.editable.types[b.type].plugin||function(){},i=a.editable.types[b.type].submit||function(){},p=a.editable.types[b.type].buttons||a.editable.types.defaults.buttons,
n=a.editable.types[b.type].content||a.editable.types.defaults.content,q=a.editable.types[b.type].element||a.editable.types.defaults.element,m=a.editable.types[b.type].reset||a.editable.types.defaults.reset,o=b.callback||function(){},r=b.onedit||function(){},s=b.onsubmit||function(){},t=b.onreset||function(){},u=b.onerror||m;b.tooltip&&a(this).attr("title",b.tooltip);b.autowidth="auto"==b.width;b.autoheight="auto"==b.height;return this.each(function(){var d=this,c=a(d).width(),e=a(d).height();a(this).data("event.editable",
b.event);a.trim(a(this).html())||a(this).html(b.placeholder);a(this).bind(b.event,function(j){if(!0!==a(this).data("disabled.editable")&&!d.editing&&!1!==r.apply(this,[b,d])){j.preventDefault();j.stopPropagation();b.tooltip&&a(d).removeAttr("title");if(0==a(d).width())b.width=c,b.height=e;else{if(b.width!="none")b.width=b.autowidth?a(d).width():b.width;if(b.height!="none")b.height=b.autoheight?a(d).height():b.height}a(this).html().toLowerCase().replace(/(;|")/g,"")==b.placeholder.toLowerCase().replace(/(;|")/g,
"")&&a(this).html("");d.editing=!0;d.revert=a(d).html();a(d).html("");var f=a("<form />");b.cssclass&&("inherit"==b.cssclass?f.attr("class",a(d).attr("class")):f.attr("class",b.cssclass));b.style&&("inherit"==b.style?(f.attr("style",a(d).attr("style")),f.css("display",a(d).css("display"))):f.attr("style",b.style));var g=q.apply(f,[b,d]),k;if(b.loadurl){var l=setTimeout(function(){g.disabled=!0;n.apply(f,[b.loadtext,b,d])},100),j={};j[b.id]=d.id;a.isFunction(b.loaddata)?a.extend(j,b.loaddata.apply(d,
[d.revert,b])):a.extend(j,b.loaddata);a.ajax({type:b.loadtype,url:b.loadurl,data:j,async:!1,success:function(a){window.clearTimeout(l);k=a;g.disabled=!1}})}else b.data?(k=b.data,a.isFunction(b.data)&&(k=b.data.apply(d,[d.revert,b]))):k=d.revert;n.apply(f,[k,b,d]);g.attr("name",b.name);p.apply(f,[b,d]);a(d).append(f);h.apply(f,[b,d]);a(":input:visible:enabled:first",f).focus();b.select&&g.select();g.keydown(function(a){a.keyCode==27&&(a.preventDefault(),m.apply(f,[b,d]))});"cancel"==b.onblur?g.blur(function(){l=
setTimeout(function(){m.apply(f,[b,d])},500)}):"submit"==b.onblur?g.blur(function(){l=setTimeout(function(){f.submit()},200)}):a.isFunction(b.onblur)?g.blur(function(){b.onblur.apply(d,[g.val(),b])}):g.blur(function(){});f.submit(function(c){l&&clearTimeout(l);c.preventDefault();if(!1!==s.apply(f,[b,d])&&!1!==i.apply(f,[b,d]))if(a.isFunction(b.target))c=b.target.apply(d,[g.val(),b]),a(d).html(c),d.editing=!1,o.apply(d,[d.innerHTML,b]),a.trim(a(d).html())||a(d).html(b.placeholder);else{c={};c[b.name]=
g.val();c[b.id]=d.id;a.isFunction(b.submitdata)?a.extend(c,b.submitdata.apply(d,[d.revert,b])):a.extend(c,b.submitdata);"PUT"==b.method&&(c._method="put");a(d).html(b.indicator);var e={type:"POST",data:c,dataType:"html",url:b.target,success:function(c){e.dataType=="html"&&a(d).html(c);d.editing=!1;o.apply(d,[c,b]);a.trim(a(d).html())||a(d).html(b.placeholder)},error:function(a){u.apply(f,[b,d,a])}};a.extend(e,b.ajaxoptions);a.ajax(e)}a(d).attr("title",b.tooltip);return!1})}});this.reset=function(c){if(this.editing&&
!1!==t.apply(c,[b,d]))a(d).html(d.revert),d.editing=!1,a.trim(a(d).html())||a(d).html(b.placeholder),b.tooltip&&a(d).attr("title",b.tooltip)}})}};a.editable={types:{defaults:{element:function(){var c=a('<input type="hidden"></input>');a(this).append(c);return c},content:function(c){a(":input:first",this).val(c)},reset:function(a,e){e.reset(this)},buttons:function(c,e){var b=this;if(c.submit){if(c.submit.match(/>$/))var h=a(c.submit).click(function(){h.attr("type")!="submit"&&b.submit()});else h=a('<button type="submit" />'),
h.html(c.submit);a(this).append(h)}if(c.cancel){if(c.cancel.match(/>$/))var i=a(c.cancel);else i=a('<button type="cancel" />'),i.html(c.cancel);a(this).append(i);a(i).click(function(){(a.isFunction(a.editable.types[c.type].reset)?a.editable.types[c.type].reset:a.editable.types.defaults.reset).apply(b,[c,e]);return!1})}}},text:{element:function(c){var e=a("<input />");c.width!="none"&&e.width(c.width);c.height!="none"&&e.height(c.height);e.attr("autocomplete","off");a(this).append(e);return e}},textarea:{element:function(c){var e=
a("<textarea />");c.rows?e.attr("rows",c.rows):c.height!="none"&&e.height(c.height);c.cols?e.attr("cols",c.cols):c.width!="none"&&e.width(c.width);a(this).append(e);return e}},select:{element:function(){var c=a("<select />");a(this).append(c);return c},content:function(c,e,b){if(String==c.constructor)eval("var json = "+c);else var h=c;for(var i in h)h.hasOwnProperty(i)&&"selected"!=i&&(c=a("<option />").val(i).append(h[i]),a("select",this).append(c));a("select",this).children().each(function(){(a(this).val()==
h.selected||a(this).text()==a.trim(b.revert))&&a(this).attr("selected","selected")})}}},addInputType:function(c,e){a.editable.types[c]=e}};a.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},ajaxoptions:{}}})(jQuery);
